<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Détails incident</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background: #f4f7fb;
    }
    .card-box {
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    .label {
      font-weight: 600;
      width: 200px;
      display: inline-block;
    }
  </style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark navbar-expand-lg bg-dark shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">IoT Supervision</a>

    <div class="collapse navbar-collapse show">
      <ul class="navbar-nav ms-auto align-items-center gap-2">

        <li class="nav-item">
          <a class="nav-link" href="/">Dashboard</a>
        </li>

        <li class="nav-item">
          <a class="nav-link active" href="/incident/archive/">Historique incidents</a>
        </li>

        <!-- USER CONNECTÉ -->
        <li class="nav-item dropdown ms-3">
          <a class="nav-link dropdown-toggle d-flex align-items-center"
             href="#"
             role="button"
             data-bs-toggle="dropdown"
             aria-expanded="false">
            <i class="bi bi-person-circle fs-5 me-1"></i>
            {{ request.user.username }}
          </a>

          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <span class="dropdown-item-text text-muted small">
                Connecté
              </span>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <form method="post" action="{% url 'logout' %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="dropdown-item text-danger">
                  <i class="bi bi-box-arrow-right me-1"></i> Déconnexion
                </button>
              </form>
            </li>
          </ul>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- HEADER -->
<div class="container my-5 text-center">
  <h1 class="fw-bold">Détails incident #{{ incident.id }}</h1>
  <p class="text-muted">Informations complètes de l’incident</p>
</div>

<div class="container mb-3">
  <a href="{% url 'incident_archive' %}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left me-1"></i> Retour
  </a>
</div>

<!-- DETAILS -->
<div class="container mb-5">
  <div class="card card-box p-4">

    <div class="mb-3">
      <span class="label">Statut :</span>
      {% if incident.is_open %}
        <span class="fw-semibold text-success">Ouvert</span>
      {% else %}
        <span class="fw-semibold text-danger">Fermé</span>
      {% endif %}
    </div>

    <div class="mb-2">
      <span class="label">Début :</span>
      {{ incident.start_at|date:"d/m/Y H:i:s" }}
    </div>

    <div class="mb-2">
      <span class="label">Fin :</span>
      {% if incident.is_open %}
        <span class="text-success fw-semibold">En cours</span>
      {% else %}
        {{ incident.end_at|date:"d/m/Y H:i:s" }}
      {% endif %}
    </div>

    <div class="mb-2">
      <span class="label">Température min :</span>
      <span class="fw-semibold">{{ incident.min_temp }} °C</span>
    </div>

    <div class="mb-2">
      <span class="label">Température max :</span>
      <span class="fw-semibold">{{ incident.max_temp }} °C</span>
    </div>

    <div class="mb-3">
      <span class="label">Compteur :</span>
      {{ incident.counter }}
    </div>

    <hr>

    <h5 class="fw-bold mb-3">Validation opérateurs</h5>

    <!-- OP 1 -->
    <div class="mb-2">
      <span class="label">Opérateur 1 ACK :</span>
      {% if incident.op1_ack %}
        <span class="text-success fw-semibold">Oui</span>
      {% else %}
        <span class="text-muted">Non</span>
      {% endif %}
    </div>
    <div class="mb-3">
      <span class="label">Commentaire :</span>
      {{ incident.op1_comment|default:"—" }}
    </div>

    <!-- OP 2 -->
    <div class="mb-2">
      <span class="label">Opérateur 2 ACK :</span>
      {% if incident.op2_ack %}
        <span class="text-success fw-semibold">Oui</span>
      {% else %}
        <span class="text-muted">Non</span>
      {% endif %}
    </div>
    <div class="mb-3">
      <span class="label">Commentaire :</span>
      {{ incident.op2_comment|default:"—" }}
    </div>

    <!-- OP 3 -->
    <div class="mb-2">
      <span class="label">Opérateur 3 ACK :</span>
      {% if incident.op3_ack %}
        <span class="text-success fw-semibold">Oui</span>
      {% else %}
        <span class="text-muted">Non</span>
      {% endif %}
    </div>
    <div class="mb-3">
      <span class="label">Commentaire :</span>
      {{ incident.op3_comment|default:"—" }}
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
